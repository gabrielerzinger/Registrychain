<div *ngIf="user" class="container">
	<div class="row my-2 mx-0 pt-5">
		<div class="col-xs-12 col-sm-4 col-lg-3 text-center">
			<img src="//placehold.it/150" class="mx-auto rounded" alt="avatar">
			<p class="mt-2">Olá, {{user.name.split(' ')[0]}}!</p>
		</div>
		<div class="col-xs-12 col-sm-8 col-lg-9">
			<tabset>
				<tab heading="Perfil">
					<div class="p-4">
						<div class="tab-pane active">
							<h3 class="mb-5">Seja Bem-Vindo, {{user.name}}!</h3>
							<div class="row mx-0">
								<div class="col-sm-12">
									<h4 class="mb-3">Seus Dados:</h4>
									<div class="row mx-0">
										<div class="col-sm-3">
											<strong>CPF:</strong>
										</div>
										<div class="col-sm-9">
											{{user.cpf}}
										</div>
									</div>
									<div class="row mx-0">
										<div class="col-sm-3">
											<strong>RG:</strong>
										</div>
										<div class="col-sm-9">
											{{user.rg}}
										</div>
									</div>
									<div class="row mx-0">
										<div class="col-sm-3">
											<strong>Endereço:</strong>
										</div>
										<div class="col-sm-9">
											{{user.address}}
										</div>
									</div>
									<div class="row mx-0">
										<div class="col-sm-3">
											<strong>Email:</strong>
										</div>
										<div class="col-sm-9">
											{{user.email}}
										</div>
									</div>
									<div class="row mx-0 pt-4">
										<div class="col-sm-4">
											<h5>Chave Pública:</h5>
										</div>
									</div>
									<div class="row">
										<div class="col-sm-12">
											<img id="qrcode" [src]="user.pubkeyurl">
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</tab>
				<tab heading="Contratos">
					<div class="tab-pane">
						<div class="p-3">
							<h4>Contratos Pendentes</h4>
							<table class="table table-hover table-striped mt-3" *ngIf="!loadingPending">
								<thead>
									<tr>
										<th>Contrato ID</th>
										<th>Contraparte</th>
										<th>Ação</th>
									</tr>
								</thead>
								<tbody>
									<tr *ngFor="let c of pendingContracts">
										<td><a href="javascript:void(0);" (click)="selectContract(c); contractModal.show()" tooltip="Clique para ver este contrato">{{c._id}}</a></td>
										<td>{{getCounterpart(c).user.name}}</td>
										<td>
											<button class="btn btn-success"  (click)="accept(c)" *ngIf="!getMe(c).accepted">Aceitar</button>
											<button class="btn btn-danger ml-2" (click)="refuse(c)">{{getMe(c).accepted?'Cancelar':'Rejeitar'}}</button>
										</td>
									</tr>
								</tbody>
							</table>
							<div class="text-center" *ngIf="loadingPending">
								<i class="fas fa-spinner fa-pulse fa-3x"></i>
							</div>
						</div>
						<div class="p-3">
							<h4>Contratos Celebrados</h4>
							<table class="table table-hover table-striped mt-3" *ngIf="!loadingCelebrated">
								<thead>
									<tr>
										<th>Contrato ID</th>
										<th>Contraparte</th>
										<th>Celebrado em</th>
									</tr>
								</thead>
								<tbody>
									<tr *ngFor="let c of myContracts">
										<td><a href="javascript:void(0);" (click)="selectContract(c); contractModal.show()" tooltip="Clique para ver este contrato">{{c._id}}</a></td>
										<td>{{getCounterpart(c).user.name}}</td>
										<td>{{c.celebrationDate}}</td>
									</tr>
								</tbody>
							</table>
							<div class="text-center" *ngIf="loadingCelebrated">
								<i class="fas fa-spinner fa-pulse fa-3x"></i>
							</div>
							<div class="btn-group" dropdown>
								<button id="button-basic" dropdownToggle type="button" class="btn btn-primary dropdown-toggle">
									Novo Contrato <span class="caret"></span>
								</button>
								<ul id="dropdown-basic" *dropdownMenu class="dropdown-menu" role="menu">
									<li role="menuItem"><a class="dropdown-item" routerLink="/c2c">Pessoa Física</a></li>
									<li role="menuItem"><a class="dropdown-item" routerLink="/cev">Compra &amp; Venda</a></li>
									<li role="menuItem"><a class="dropdown-item" href="javascript:void(0);">União Estável</a></li>
								</ul>
							</div>
						</div>
					</div>
				</tab>
			</tabset>
		</div>
	</div>
</div>

<div class="modal fade" bsModal #contractModal="bs-modal" tabindex="-1">
	<div class="modal-dialog" *ngIf="selectedContract">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title pull-left">Contrato {{ selectedContract.type == 'c2c' ? 'Entre Pessoas Físicas':'De Compra &amp; Venda' }}</h4>
				<button type="button" class="close pull-right" (click)="contractModal.hide()">
					<span>&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<div class="container text-center card p-3">
					<h5>Contrato ID {{selectedContract._id}}</h5>
					<h6>{{selectedContract.status == 'celebrated' ? 'Celebrado em '+ selectedContract.celebrationDate : 'Assinatura(s) pendente(s)'}}</h6>
					<br>
					<h5>Identificação das partes:</h5>
					<div class="card text-justify p-3">
						<p>
							<strong>{{selectedContract.type == 'c2c'? 'Contratante: ':'Vendedor: '}}</strong>
							<span *ngIf="selectedContract.status != 'celebrated'">{{ selectedPart2.name }}</span>
						</p>
						<div *ngIf="selectedContract.status == 'celebrated'" class="text-justify pl-3">
							<div class="row mx-0">
								<div class="col-sm-4">
									<strong>Nome:</strong>
								</div>
								<div class="col-sm-8">
									{{selectedPart2.name}}
								</div>
							</div>
							<div class="row mx-0">
								<div class="col-sm-4">
									<strong>CPF:</strong>
								</div>
								<div class="col-sm-8">
									{{selectedPart2.cpf}}
								</div>
							</div>
							<div class="row mx-0">
								<div class="col-sm-4">
									<strong>RG:</strong>
								</div>
								<div class="col-sm-8">
									{{selectedPart2.rg}}
								</div>
							</div>
							<div class="row mx-0">
								<div class="col-sm-4">
									<strong>Endereço:</strong>
								</div>
								<div class="col-sm-8">
									{{selectedPart2.address}}
								</div>
							</div>
							<div class="row mx-0">
								<div class="col-sm-4">
									<strong>Email:</strong>
								</div>
								<div class="col-sm-8">
									{{selectedPart2.email}}
								</div>
							</div>
						</div>
						<br>
						<p>
							<strong>{{selectedContract.type == 'c2c' ? 'Contratada: ':'Comprador: '}}</strong>
							<span *ngIf="selectedContract.status != 'celebrated'">{{ selectedPart1.name }}</span>
						</p>
						<div *ngIf="selectedContract.status == 'celebrated'" class="text-justify pl-3">
							<div class="row mx-0">
								<div class="col-sm-4">
									<strong>Nome:</strong>
								</div>
								<div class="col-sm-8">
									{{selectedPart1.name}}
								</div>
							</div>
							<div class="row mx-0">
								<div class="col-sm-4">
									<strong>CPF:</strong>
								</div>
								<div class="col-sm-8">
									{{selectedPart1.cpf}}
								</div>
							</div>
							<div class="row mx-0">
								<div class="col-sm-4">
									<strong>RG:</strong>
								</div>
								<div class="col-sm-8">
									{{selectedPart1.rg}}
								</div>
							</div>
							<div class="row mx-0">
								<div class="col-sm-4">
									<strong>Endereço:</strong>
								</div>
								<div class="col-sm-8">
									{{selectedPart1.address}}
								</div>
							</div>
							<div class="row mx-0">
								<div class="col-sm-4">
									<strong>Email:</strong>
								</div>
								<div class="col-sm-8">
									{{selectedPart1.email}}
								</div>
							</div>
						</div>
					</div>
					<br>
					<h5 *ngIf="selectedContract.type == 'cev'">Do Objeto:</h5>
					<div *ngIf="selectedContract.type == 'cev'" class="text-justify pl-3 card">
						<div class="row mx-0">
							<div class="col-sm-4">
								<strong>Bem:</strong>
							</div>
							<div class="col-sm-8">
								{{selectedContract.item.name}}
							</div>
						</div>
						<div class="row mx-0">
							<div class="col-sm-4">
								<strong>Valor:</strong>
							</div>
							<div class="col-sm-8">
								R$ {{selectedContract.item.value}}
							</div>
						</div>
						<div class="row mx-0">
							<div class="col-sm-4">
								<strong>Pagamento:</strong>
							</div>
							<div class="col-sm-8">
								{{selectedContract.paymentMethod}}
							</div>
						</div>
					</div>
					<br *ngIf="selectedContract.type == 'cev'">
					<h5>Descrição do contrato:</h5>
					<div class="card text-justify p-3">
						<p>{{selectedContract.description}}</p>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
